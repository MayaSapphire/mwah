<!doctype html>
<html>
    <head>
        <title>
            Maya's Word Analysis Helper
        </title>
        <style>
        * {
            margin: 0px;
            padding: 0px;
        }
        body {
            margin-left: 100px;
            margin-right:100px;

            margin-top: 20px;
            min-height:100vh;
            font-family:sans-serif;
        }
        th, td {
            padding-left: 10px;
            padding-right: 10px;
            text-align: left;

        }
        tr:nth-child(even) {background-color: #f2f2f2;}
        </style>
    </head>
    <body>
        <h1>
            Maya's Word Analysis Helper
        </h1>

        <p>
            Usable link: <a href=https://mayasapphire.github.io/mwah/index.html>https://mayasapphire.github.io/mwah/index.html</a> <br><br>

            Paste a block of text, and this program will show you how many times each word is used.<br><br>

            Features:<br>
            <ul>
                <li>This is <b>free software</b>, released under <a href=https://choosealicense.com/licenses/mit/>the MIT license</a>.<br>
                You may use, copy, modify, and distribute this software however you wish.</li>
                <li>No ads, no tracking, no spyware. Just a very fast program.</li>
                <li>Text entered will not be sent online.<br>
                All processing is done locally, on your own machine.</li>
                <li>This page can be downloaded and used without an Internet connection.</li>
            </ul>
            <br>
            Limitations: <br>
                <li>This page was designed and tested for desktop computers.<br>
                It may not load properly on mobile devices.</li>
                <li>While this program is largely finished, it likely still has bugs.</li>
                <li>Some characters (such as punctuation) may cause this program to behave incorrectly.</li>
            </ul>
            <br>


            <form id="theForm" action="#" onsubmit="event.preventDefault(); analyzeText();">

            <label for="text">Submit the text to be analyzed here:<br></label>

            <textarea name="text" placeholder="Here is where you can paste your text.
You can change the width and height of this box, too!" rows="10" cols = "100"></textarea><br>

            <label for="sort">How should the list be sorted?</label>

            <select name="sort" id="sort">
                <option value="unsorted">Do not sort</option>
                <option value="alphabetically-ascending">Alphabetically, A to Z</option>
                <option value="alphabetically-descending">Alphabetically, Z to A</option>
                <option value="occurrences-ascending">Number of occurrences, low to high</option>
                <option value="occurrences-descending">Number of occurrences, high to low</option>
            </select> <br>
            <input type="checkbox" name="remove-numbers" value="true">
            <label for="remove-numbers" >Exclude words that only have numbers in them</label><br>

            <input type="submit" value="Analyze!">

            <p id="loading"></p>

            <table>

                <tbody id="tbody"></tbody>
            </table>
        </p>
        <script>

            function analyzeText() {

                // display a loading text
                var loading = document.getElementById('loading');
                loading.innerHTML = "Please wait...";


                var formData = new FormData(document.querySelector('form'));

                // get text, make it good
                text = toTitleCase(formData.get('text'));
                // /g makes the regex do the whole string instead of just the first instance
                text = text.replace(/\n/g, " "); // turn newlines to spaces
                text = text.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()\[\]\"—‘’“”<>?]/g,""); // remove all punctuation


                var textSplit = text.split(" "); // make an array of words

                // if we're excluding words that only have numbers in them, we can do that now
                if (formData.get('remove-numbers')) {

                    function integerCheck(inputStr) {
                        let isnum = /^\d+$/.test(inputStr); // test if the word contains only digits

                        return !isnum; // return the opposite

                    }
                    textSplit = textSplit.filter((word) => integerCheck(word));
                }

                // if we're sorting alphabetically, it's best to do that now
                sortOption = formData.get('sort');
                if (sortOption == 'alphabetically-ascending') {
                    textSplit = textSplit.sort();
                } else if (sortOption == 'alphabetically-descending') {
                    textSplit = textSplit.sort();
                    textSplit = textSplit.reverse();

                }

                var counts = {}; // object of words and counts

                for (const str of textSplit) {
                    counts[str] = counts[str] ? counts [str] + 1 : 1;
                }

                // sort the words
                // sortOption was already defined earlier
                if (sortOption == 'unsorted'){
                    // leave current behavior
                } else if (sortOption == 'alphabetically-ascending') {
                    // already checked earlier
                } else if (sortOption == 'alphabetically-descending') {
                    // already checked earlier

                } else if (sortOption == 'occurrences-ascending') {

                    // counts is an object. we need to be an array of arrays
                    countsArray = Object.entries(counts);

                    // now that it's in an array, we can sort it
                    countsArray.sort((a, b) => a[1] - b[1]);

                    // and now we can put it back in an object so it doesn't break any other things!
                    counts = Object.fromEntries(countsArray)
                    // i should be banned from coding forever

                } else if (sortOption == 'occurrences-descending') {

                    // counts is an object. we need to be an array of arrays
                    countsArray = Object.entries(counts);

                    // now that it's in an array, we can sort it
                    countsArray.sort((a, b) => b[1] - a[1]); // b - a makes it reversed

                    // and now we can put it back in an object so it doesn't break any other things!
                    counts = Object.fromEntries(countsArray)
                    // i should be banned from coding forever

                } else {
                    // we shouldn't get here...
                    alert("Invalid sort option: " + sortOption + ". \n This is a bug. Please report this.")

                }

                // put data into table
                var tbody = document.getElementById('tbody');


                var tb = '<tr><th>Word</th><th>Number of occurrences</th></tr>' // table header
                for (var key in counts) {
                    if (key == '') { // if it's that stupid empty string that i hate
                        continue; // skip it
                    }
                    var tr = "<tr>";
                    tr += "<td>" + key + "</td>" + "<td>" + counts[key] + "</td></tr>";
                    tb += tr
                }
                //alert(tr);
                tbody.innerHTML = tb;

                // remove loading string
                loading.innerHTML = "";

            }

            function toTitleCase(str) {
                return str.replace(
                    /\w\S*/g,
                    text => text.charAt(0).toUpperCase() + text.substring(1).toLowerCase()
                );
            }

            function sanitize(input) {
                if (input == null) {
                    return null
                }
                return input.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#x27;").replace(/\//g, "&#x2F;").replaceAll('\r\n', '\\r\\n').replaceAll('\r', '\\r');
            }


        </script>
        <p><center><i>Made with spite by MayaSapphire</i></center></p>
        <!-- If you're reading this, thanks for reading my source code
        I hope you know that you are particularly amazing -->
    </body>
</html>
